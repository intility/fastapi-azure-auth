"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([["844"],{3184:function(e,n,t){t.r(n),t.d(n,{default:()=>l,frontMatter:()=>r,metadata:()=>s,assets:()=>d,toc:()=>c,contentTitle:()=>o});var s=JSON.parse('{"id":"usage-and-faq/locking_down_on_roles","title":"Locking down on roles","description":"Azure setup","source":"@site/docs/usage-and-faq/locking_down_on_roles.mdx","sourceDirName":"usage-and-faq","slug":"/usage-and-faq/locking_down_on_roles","permalink":"/fastapi-azure-auth/usage-and-faq/locking_down_on_roles","draft":false,"unlisted":false,"editUrl":"https://github.com/Intility/FastAPI-Azure-Auth/edit/main/docs/docs/usage-and-faq/locking_down_on_roles.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Locking down on roles","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Guest Users","permalink":"/fastapi-azure-auth/usage-and-faq/guest_users"},"next":{"title":"Calling your APIs from Python","permalink":"/fastapi-azure-auth/usage-and-faq/calling_your_apis_from_python"}}'),a=t("5893"),i=t("65");let r={title:"Locking down on roles",sidebar_position:3},o=void 0,d={},c=[{value:"Azure setup",id:"azure-setup",level:2},{value:"App code",id:"app-code",level:2}];function u(e){let n={a:"a",code:"code",h2:"h2",img:"img",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"azure-setup",children:"Azure setup"}),"\n",(0,a.jsxs)(n.p,{children:["Go to your application registration, click ",(0,a.jsx)(n.code,{children:"Groups"}),":\n",(0,a.jsx)(n.img,{alt:"manifest",src:t(679).Z+"",width:"301",height:"635"})]}),"\n",(0,a.jsxs)(n.p,{children:["Create a role:\n",(0,a.jsx)(n.img,{alt:"manifest",src:t(8719).Z+"",width:"580",height:"506"})]}),"\n",(0,a.jsxs)(n.p,{children:["Go to Overview and click the Enterprise application link:\n",(0,a.jsx)(n.img,{alt:"manifest",src:t(8563).Z+"",width:"1678",height:"392"})]}),"\n",(0,a.jsxs)(n.p,{children:["Go to ",(0,a.jsx)(n.code,{children:"Users and groups"})," and add a user/group:\n",(0,a.jsx)(n.img,{alt:"manifest",src:t(6610).Z+"",width:"379",height:"390"})]}),"\n",(0,a.jsxs)(n.p,{children:["Add the user/group that you want to have this role (if you use a group, the users must be a direct member of that group. Nested membership does not work):\n",(0,a.jsx)(n.img,{alt:"manifest",src:t(9023).Z+"",width:"599",height:"1205"})]}),"\n",(0,a.jsxs)(n.p,{children:["Click ",(0,a.jsx)(n.code,{children:"select role"})," and assign the user/role to your application role:\n",(0,a.jsx)(n.img,{alt:"manifest",src:t(8469).Z+"",width:"296",height:"612"})]}),"\n",(0,a.jsxs)(n.p,{children:["Finish by clicking ",(0,a.jsx)(n.code,{children:"Assign"}),". The user will now have that group in their token."]}),"\n",(0,a.jsx)(n.h2,{id:"app-code",children:"App code"}),"\n",(0,a.jsx)(n.p,{children:"You can lock down on roles by creating your own wrapper dependency:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",metastring:'title="dependencies.py"',children:'from fastapi import Depends\nfrom fastapi_azure_auth.exceptions import Unauthorized\nfrom fastapi_azure_auth.user import User\n\nasync def validate_is_admin_user(user: User = Depends(azure_scheme)) -> None:\n    """\n    Validate that a user is in the `AdminUser` role in order to access the API.\n    Raises a 401 authentication error if not.\n    """\n    if \'AdminUser\' not in user.roles:\n        raise Unauthorized(\'User is not an AdminUser\')\n'})}),"\n",(0,a.jsxs)(n.p,{children:["and then use this dependency over ",(0,a.jsx)(n.code,{children:"azure_scheme"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Alternatively, after ",(0,a.jsx)(n.a,{href:"https://github.com/tiangolo/fastapi/releases/tag/0.95.0",children:"FastAPI 0.95.0"})," you can create an\n",(0,a.jsx)(n.code,{children:"Annotated"})," dependency."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",metastring:'title="security.py"',children:'from typing import Annotated\nfrom fastapi import Depends\nfrom fastapi_azure_auth.exceptions import Unauthorized\nfrom fastapi_azure_auth.user import User\n\nasync def validate_is_admin_user(user: User = Depends(azure_scheme)) -> None:\n    """\n    Validate that a user is in the `AdminUser` role in order to access the API.\n    Raises a 401 authentication error if not.\n    """\n    if \'AdminUser\' not in user.roles:\n        raise Unauthorized(\'User is not an AdminUser\')\n\nAdminUser = Annotated[User, Depends(validate_is_admin_user)]\n'})}),"\n",(0,a.jsx)(n.p,{children:"and in your view:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",metastring:'title="my_view.py"',children:'@app.get("/items/")\ndef read_items(user: AdminUser):\n    ...\n'})})]})}function l(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},679:function(e,n,t){t.d(n,{Z:function(){return s}});let s=t.p+"assets/images/role_1-1d8214ae0485ad4da3add1fa2933977a.png"},8719:function(e,n,t){t.d(n,{Z:function(){return s}});let s=t.p+"assets/images/role_2-453b6175f5be07285deea80af2d6a9a3.png"},8563:function(e,n,t){t.d(n,{Z:function(){return s}});let s=t.p+"assets/images/role_3-c7f381e26e676ec964ac34635b03a1f8.png"},6610:function(e,n,t){t.d(n,{Z:function(){return s}});let s=t.p+"assets/images/role_4-8aeba628977ee3ffb2a39f6aa4efe8db.png"},9023:function(e,n,t){t.d(n,{Z:function(){return s}});let s=t.p+"assets/images/role_5-5678faac6d5b106d43133f3c447fdfcb.png"},8469:function(e,n,t){t.d(n,{Z:function(){return s}});let s=t.p+"assets/images/role_6-2b5463ce35eb34ce4c36ea3a44653a92.png"},65:function(e,n,t){t.d(n,{Z:function(){return o},a:function(){return r}});var s=t(7294);let a={},i=s.createContext(a);function r(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);